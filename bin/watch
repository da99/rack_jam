#!/usr/bin/env bash
# -*- bash -*-
#
#!/usr/bin/env node
# -*- js   -*-
#
#!/usr/bin/env lua
#
#

cmd="$@"

#
# set -u -e -o pipefail
#
#  For more info on inotifywait:
#    http://manpages.ubuntu.com/manpages/hardy/man1/inotifywait.1.html
#

while true; do
  change=$(inotifywait -r .)
  echo $change
  echo ""

  # Yes, I know. I need to learn sed:
  if [[ ( ! -z "$cmd" ) && ( ! "$change" =~ " OPEN ") && ( "$change" =~ "CLOSE_WRITE" || "$change" =~ " CHANGE " ) && "$change" =~ ".lua" ]]
  then
    $cmd
  fi

done



